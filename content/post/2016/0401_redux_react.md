+++
date = "2016-04-04T18:55:03+09:00"
draft = true
tags = ['Redux']
title = "【訳読】2.5 Usage with React|Redux"

+++

## Usage with React

初めのうちは、ReduxがReactになんの関係もないことにストレスをうける。
ReduxはReactにもAngularにも、Ember、jQueryにも使える。

ただとりわけ、Reactや[Deku](https://github.com/dekujs/deku)とは相性がいい。

## Installing React Redux

デフォルトではReduxにはReactとのバインディングは含まれないので下記をインストールする。

```
npm install --save react-redux
```

## Presentational and Container Components

React Bindingsは`Presentational Component`と`Container Component`を分けて考える。
詳しくなかったら[これ](https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0)を読むこと。

||Presentational Components|Container Components|
|Purpose|見た目|動き(フェッチ、ステート更新)|
|Awate of Redux|No|Yes|
|To read data|Read data from props|Subscribe to state|
|To change data|Invoke callbacks from props|Dispatch Redux actions|
|Are written|By hand|Usually generated by React Redux|

大半のComponentがpresentationalになるだろう。けれどもコンポーネントをRedux　StoreにつなぐためにいくつかのContainer Componentを作成する必要がある。

`store.subscribe()`を使えば技術的にはContainer Componentsを手書きすることができる。
とりあえず、`connect()`を使えばContainer Componentを作ることができる。

## Designing Component Hierarchy

ルートStateの設計方法を思い出せる？
UI部分も設計していこう。Reduxに特有のことでもないからReactのチュートリアルを参考に進めていく。

設計はシンプルだ。ToDoアイテムのリストを表示し、クリックした時にToDoアイテムを完了したい。
ユーザーが新しいToDoを追加するためのフィールドを用意したい。フッターには、"全表示"/"完了のみ"/"アクティブのみ"のトグルを用意したい。

### Presentational Components

- `TodoList`: ToDoのリスト
  - `todos`: アイテムの入れる
  - `onTodoClick(id:number)`
- `Todo`: 単一のアイテム
  - `test:string`
  - `completed:boolean`
  - `onClick`
- `Link`: コールバックのリンク
  - `onClick`
- `Footer`
- `App`: ルートComponent Properties

これらは見た目の部分であり、データがどこから来ているか、どのように変更されているかということを知らない。
与えられたものをレンダリングするのみ。Reduxに依存しないので、Redux以外のものへマイグレートしても同じものを表示できる。

### Container Components

Presentational ComponentをReduxへ連結するためのContainer Componentが必要だ。
例えばPresentationalの`TodoList`は`VisibleTodoList`といったReduxのStoreへ伝えたり、現在のフィルタをどう適用するかを知るContainerが必要。
visibilityFilterを変更するために、`FilterLink` Container Componentを提供する。

- `VisibleTodoList`
- `FilterLink`

### Other Components

時々どっちとも言えないようなComponentがある。
例えばフォームや関数が複雑になっているもの。

- `AddTodo`: inputフィールド

技術的にはこれらを2つのComponentに分割することができるが、やり過ぎ感がある。大きくなったら分割する。

## Implementing Components

Componentを書いていこう！presentationalから始めるからReducのことは考えなくていい。

### Presentational Components

`components/Todo.js:`

```
import React, { PropTypes } from 'react'

const Todo = ({ onClick, completed, text }) => (
  <li
    onClick={onClick}
    style={{
      textDecoration: completed ? 'line-through' : 'none'
    }}
  >
    {text}
  </li>
)

Todo.propTypes = {
  onClick: PropTypes.func.isRequired,
  completed: PropTypes.bool.isRequired,
  text: PropTypes.string.isRequired
}

export default Todo
```

`components/TodoList.js:`

```
import React, { PropTypes } from 'react'
import Todo from './Todo'

const TodoList = ({ todos, onTodoClick }) => (
  <ul>
    {todos.map(todo =>
      <Todo
        key={todo.id}
        {...todo}
        onClick={() => onTodoClick(todo.id)}
      />
    )}
  </ul>
)

TodoList.propTypes = {
  todos: PropTypes.arrayOf(PropTypes.shape({
    id: PropTypes.number.isRequired,
    completed: PropTypes.bool.isRequired,
    text: PropTypes.string.isRequired
  }).isRequired).isRequired,
  onTodoClick: PropTypes.func.isRequired
}

export default TodoList

```

`components/Link.js:`

```
import React, { PropTypes } from 'react'

const Link = ({ active, children, onClick }) => {
  if (active) {
    return <span>{children}</span>
  }

  return (
    <a href="#"
       onClick={e => {
         e.preventDefault()
         onClick()
       }}
    >
      {children}
    </a>
  )
}

Link.propTypes = {
  active: PropTypes.bool.isRequired,
  children: PropTypes.node.isRequired,
  onClick: PropTypes.func.isRequired
}

export default Link
```

`components/Footer.js:`


```
import React from 'react'
import FilterLink from '../containers/FilterLink'

const Footer = () => (
  <p>
    Show:
    {" "}
    <FilterLink filter="SHOW_ALL">
      All
    </FilterLink>
    {", "}
    <FilterLink filter="SHOW_ACTIVE">
      Active
    </FilterLink>
    {", "}
    <FilterLink filter="SHOW_COMPLETED">
      Completed
    </FilterLink>
  </p>
)

export default Footer
```

`components/App.js:`

```
import React from 'react'
import Footer from './Footer'
import AddTodo from '../containers/AddTodo'
import VisibleTodoList from '../containers/VisibleTodoList'

const App = () => (
  <div>
    <AddTodo />
    <VisibleTodoList />
    <Footer />
  </div>
)

export default App
```

### Container Components

作成したPresentational ComponentをReduxに結びつけるComponentを作成しよう。
技術的には、Container Componentは`store.subscribe()`を使ってReduxのステートツリーを読み込み、Presentational Componentにレンダリングするためのプロパティを提供するだけのただのReact Componentだ。
手動で書くこともできるが、React Reduxは`connect()`関数で最適化しているので、そっちを使うことをおすすめする。

`connect()`を使うには、`mapStateToProps`という特別な関数を定義して、現在のRedux Store Stateを渡したいPresentational Componentに渡すプロパティにどのように変形するかを伝える必要がある。
例えば`visibleTodoList`は`TodoList`に渡す`todos`を計算する必要があるので、`state.visibleTodoFilter`に`state.todos`をフィルタする関数を定義する。そしてそれを`mapStateToProps`内で使う。

```
const getVisibleTodos = (todos, filter) => {
  switch (filter) {
    case 'SHOW_ALL':
      return todos
    case 'SHOW_COMPLETED':
      return todos.filter(t => t.completed)
    case 'SHOW_ACTIVE':
      return todos.filter(t => !t.completed)
  }
}

const mapStateToProps = (state) => {
  return {
    todos: getVisibleTodos(state.todos, state.visibilityFilter)
  }
}
```

Stateを読むことに加えて、Container ComponentはActionをdispachできる。
`mapStateToProps()`を定義して`dispatch()`を受け取り、コールバックでPresentational Coomponentにinjectするプロパティを返す。
