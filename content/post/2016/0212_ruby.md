+++
date = "2016-02-13T20:34:06+09:00"
draft = false
title = "【プログラミング言語Ruby】3章-データ型とオブジェクト"
tags = ["ruby"]
+++

### 数値

Rubyは数値を表現する5種類の組み込みクラスを持っており、
標準ライブラリにはさらに3種類の役に立ち数値クラスが含まれている。

![](https://www.evernote.com/l/AHWcSL7aQflDHarJQfPcwzy2xDWCtDv8WdUB/image.png)

Rubyの全ての数値オブジェクトは`Numeric`のインスタンスになっている。
全ての整数は`Integer`のインスタンスである。31ビット幅に収まる整数値は`Fixnum`のインスタンスであり、
そうでなければ`Bignum`のインスタンスである。
Rubyでは実数値を`Float`クラスで近似的に表現する。`Float`クラスは
プラットフォーム固有の浮動小数点表現を使う。

`Complex`クラスは複素数を表現する。
`BigDecimal`クラスは10進数表現を使って任意の制度の実数を表現する。
`Rational`クラスは有理数、すなわち整数を別の整数で除算した値を表現する。

また、全ての数値オブジェクトはイミュータブルである。

### 文字列

文字列は`String`クラスによって表現する。ミュータブルなオブジェクトである。
パターンは`Regexp`オブジェクトとして表現される。

`%q`、`%Q`はStringリテラル。

### 配列

配列とは、値の列で、列の中の位置(添字)によって値にアクセスできるようになっているものである。

`%w`、`%W`は配列リテラル。

配列は`Array.new`コンストラクタでも作成できる。

### ハッシュ

ハッシュとはキーと呼ばれるオブジェクトの集合を保持し、ここのキーに値を対応付けているデータ構造である。
キーを値にマッピングするので、ハッシュはマップとも呼ばれる。
個々のキーから値を連想するように導き出すので、連想配列とも呼ばれることもあるし、
添字が整数ではなく任意のオブジェクトになった配列と考え得ることもできる。

```
numbers = Hash.new
```

#### ハッシュリテラル

ハッシュリテラルは全体が中括弧で囲まれ、カンマで区切られたキー/値の対という形で記述される。
キーと値は`=>`という2文字の矢印で区切られる。先ほど作成したHashオブジェクトは次のリテラルでも作成できる。

```
numbers = { "one" => 1, "two" => 2, "three" => 3 }
```

一般に、ハッシュキーとしては文字列よりも`Symbol`オブジェクトの方が効率的に使える。

```
numbers = { :one => 1, :two => 2, :three => 3 }
```

`Symbol`とはinternされたイミュータブルな文字列で、プレフィックスとしてコロンが付けられた識別子という形で記述される。

Rubyのハッシュは、ハッシュテーブルというデータ構造を使って実装されている。
ハッシュのキーとして使えるオブジェクトは、キーのハッシュ値となるFixnumを返すhashという名前のメソッドを保つ必要がある。

### 範囲

Rangeオブジェクトは先頭の値から末尾の値までのすべての値を表す。範囲リテラルは、先頭の値と末尾の値の間に2個または3子のドットを入れて記述する。
ドットが２個なら範囲は包含的で、末尾の値も範囲の一部となる。
ドットが３個なら、範囲は排他的で、末尾の値は範囲に含まれない。

範囲には暗黙的に順序がある。
Stringクラスにはsuccメソッド定義されており、`'a'.succ`が'b'、`'b'.succ`が'c'である。
このように反復処理できる範囲を離散範囲(discrete range)という。短点がsuccメソッドを定義していない範囲は反復処理できないので
連続範囲(continuous range)という。
短点が整数になっている範囲は離散範囲だが、浮動小数点になっている範囲は連続範囲である。

### シンボル

Rubyの一般的な実装は、実装が把握しているすべてのクラス、メソッド、変数の名前を格納するシンボルテーブルを管理している。
シンボルテーブルがあるおかげで、インタープリタは文字列の比較をほとんどせずに済ませられる。
たとえばメソッド名は、このシンボルテーブル内でのメソッド名の位置によって参照する。
こうすることにより、比較的コストの高い文字列の処理がコストの低い整数処理に変わる。  
これらのシンボルは、純粋にインタープリタの内部構造としてしまい込まれているわけではなく、Rubyプログラムからも使えるようになっている。
Symbolオブジェクトは、シンボルを参照しているのである。シンボルリテラルは、コロンをプレフィックスとする識別子や文字列という形で書ける。

```
:symbol       # Symbolのリテラル
:"symbol"     # 全く同じリテラル
```

2個の文字列では、同じ内容を持ちつつ、全く異なるオブジェクトという場合があるが、シンボルではそのようなことは決して起きない。
同じ内容を持つ2個の文字列をシンボルに変換すると、全く同じSymbolオブジェクトになる。2つの異なるSymbolオブジェクトは、必ず異なる内容を持つ。

文字列の内容のためではなく、一種の固有な識別子として文字列を扱うコードを書こうとしているときには、シンボルを使うことを検討すると良い。
たとえば、引数として"AM"または"PM"という文字列を受け付けるメソッドを書くのではなく、:AMか:PMというシンボルを受け付けるようにするのである。
2つの文字列が等しいかどうかを比較するよりも、2つのSymbolオブジェクトが等しいかどうかを検討する方が、はるかに速い。
同じ理由から、ハッシュキーとしては一般に文字列を使うよりもシンボルを使ったほうがよい。

### true、false、nil

true、false、nilはRubyのキーワードとなっており、予約された特別な値である。
これらのキーワードを評価すると、専用のオブジェクトになる。
trueを評価すると、`TrueClass`のシングルトンインスタンスのオブジェクトになる。
同様に、falseとnilは`FalseClass`、`NilClass`のシングルトンインスタンスである。
Booleanクラスがないことに注意。

```
o == nil
o.nil?
```

### オブジェクト

Rubyはオブジェクト指向言語として非常に純度が高い。
すべての値はオブジェクトであり、他の多くの言事は異なり、原始型と呼べるようなものはない。
Rubyでは、すべてのオブジェクトはObjectだという名前のクラスの敬称をシており、
